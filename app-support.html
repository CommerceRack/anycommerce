<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Administrative Interface Login</title>

<META HTTP-EQUIV="Pragma" CONTENT="no-cache"><!-- don't cache this file. -->
<META NAME="ROBOTS" CONTENT="NONE">

<script type="text/javascript">

var myCreole;

var baseURL = '';
//in admin, used for loading app-specific files. do NOT set the base href tho.
if (document.location.protocol  == 'file:') { 
	baseURL = '';
	}
else if (document.location.port == 8888) {
	// local webserver (node.js?)
	baseURL = '/';
	}
else {
   baseURL = "";
   }

var app = {vars:{
	/////////////////////////////////\
	"release":"201346.a",   ///|> Increment this with each change. model version followed by each deployed update getting a new letter in the alphabet.
	//////////////////////////////////
	"thisSessionIsAdmin": true,
	"_clientid":"admin",
	"jqurl": (document.location.protocol == 'file:') ? "https://www.zoovy.com/jsonapi/" : "/jsonapi/",
//	"jqurl": (document.domain.indexOf('anycommerce') > -1) ?  "https://www.anycommerce.com/webapi/jquery/index.cgi" : "https://www.zoovy.com/webapi/jquery/index.cgi",
//	"secureURL" : "https://www.zoovy.com",
	"username": "", //needs to be set for header and media library. gets set in admin.initUserInterface
	"baseURL" : baseURL,
	},u:{},rq:[]};

</script>

<!--
all css includes need to be after the js that changes the base url.
css files should be included before any .js file to ensure they are downloaded in parallel
-->
<link rel="stylesheet" type="text/css" href="app-acreate/styles.css">
<link rel="stylesheet" type="text/css" href="app-admin/jquery-ui-1.10.3.custom.css" /><!-- tho the jqueryui js lib isn't used for this app, the styles are (for now) -->
<link rel="stylesheet" type="text/css" href="resources/anyplugins.css">
<link rel="stylesheet" type="text/css" href="app-admin/styles.css">

<!-- not much is going to run without these two. load em early -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>

<script type="text/javascript" src="controller.js"></script>
<script type="text/javascript" src="model.js"></script>
<script type="text/javascript" src="includes.js"></script>
<script type="text/javascript" src="resources/jquery.ui.anyplugins.js"></script>
<script type="text/javascript" src="extensions/admin/support.js"></script>
<script src="resources/jquery.showloading-v1.0.jt.js"></script>
<script type="text/javascript" src="extensions/admin/extension.js"></script>
<script src='https://crypto-js.googlecode.com/files/2.5.3-crypto-md5.js'></script>

<script type="text/javascript">
//don't execute script till both jquery AND the dom are ready.
$(document).ready(function(){
	var tmp = new zController(app);
//instantiate wiki parser.
//	myCreole = new Parse.Simple.Creole();
	app.model.addExtensions([{'namespace':'admin_support','filename':'extensions/admin/support.js'}]);
	app.model.addExtensions([{'namespace':'admin','filename':'extensions/admin/extension.js'}]);
	var uriParams = app.u.kvp2Array(location.hash.substring(1));
	if(uriParams.state == 'googleid')	{
		app.model.addDispatchToQ({
			'_cmd':'authAdminLogin',
			'authtype' : 'google:id_token',
			'id_token' : uriParams.id_token,
			'_tag':	{
				'datapointer' : 'authAdminLogin',
				'callback':function(rd){
					if(app.model.responseHasErrors(rd)){
						$('#globalMessaging').anymessage({'message':rd});
						}
					else	{
						if(app.data[rd.datapointer].authtoken)	{
							$('#appLookup').slideUp();
							app.ext.admin_support.a.showTicketManager($('#appView').show().addClass('stdMargin'));
							}
						else	{
							//hhhmm... should have been successful but no auth token. odd.
							$('#appLookup').anymessage({"message":"No authtoken was returned in the authAdminLogin response.","gMessage":true});
							}
						}
					}
				}
			},'immutable');
		app.model.dispatchThis('immutable');
		}
	});

function zLogin($form)	{
	app.calls.authAdminLogin.init($form.serializeJSON(),{'callback':function(rd){
		if(app.model.responseHasErrors(rd)){
			$('#loginFormContainer').anymessage({'message':rd});
			}
		else	{
			//login successful. now go do something.
			}
		}},'immutable');
	app.model.dispatchThis('immutable')
	}

</script>







</head>
<body class="control">
<!-- this div handles getting content to appear below the fixed header -->

<div id='appLookup' class='ui-widget ui-widget-content ui-corner-all'>
	
	<div class='logo alignCenter stdMargin'><a href="/index.html"><img src='app-admin/images/zoovy_logo-173x30.png' width='173' height='30' alt='zoovy' /></a></div>

	<div id='loginFormContainer'>
		<form name='merchantLogin' id='merchantLogin' action='#' class='clearfix marginBottom' onSubmit='return false'>
		<fieldset class='labelsAsBreaks alignedInputs alignedLabels'>
			<legend>Merchant Login</legend>
			
			<label><span>Login: </span><input type='text' name='userid' value='' required='required' class='textbox' /></label>
			<label><span>Password: </span><input type='password' name='password' value=''  required='required' class='textbox' /></label>
			
			<button class='loginbutton' onClick="zLogin($(this).closest('form'));">login</button>
		</fieldset>
		</form>
	</div>

	<div>
		
		<div class='alignCenter clearfix marginBottom'>
			<p>Or Connect With</p>
			<span class='threePLSprite google' id="authorize-button" onClick="document.location = 'https://accounts.google.com/o/oauth2/auth?response_type=token%20id_token&client_id=286671899262-sc5b20vin5ot00tqvl8g8c93iian6lt5.apps.googleusercontent.com&redirect_uri=https://www.zoovy.com/app/latest/app-support.html&scope=openid%20email&state=googleid';"></span>
		</div>
	
	</div>

</div>

<div id="appView"></div>

</body>
</html>
