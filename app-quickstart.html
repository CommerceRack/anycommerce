<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">

<!-- do not populate or add meta data, the SEO layer will add it -->
<title>Quickstart</title><!-- this will get populated by the SEO layer -->

<!-- used for optional social media extensions -->
<meta property="og:type" content="" id='ogType' >
<meta property="og:image" content="" id='ogImage' >
<meta property="og:description" content="" id='ogDescription' >

<meta name=viewport content="width=device-width, initial-scale=1">

<base href='' /><!-- leave blank so it works for a local file. updated to / if protocol is not file: -->

<meta name="description" content="">

<script type="text/javascript">
var myCreole, baseURL;

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

// Replace the UA number below with the UA property to send tracking info to.
ga('create', 'UA-XXXX-Y', 'auto');
ga('require','linker');
ga('require','ecommerce', 'ecommerce.js');
ga('set', {
	// Replace name below
	'appName' : 'MyAppName',
	'appID' : 'ZMVC',
	'appVersion' : '201405'
	});
ga('send','pageview');
ga('send','screenview');

//set base url so images, css, js, etc all load from appropriate location once deployed.
//baseURL as blank lets loadScript function run off local copy when testing locally.
if(document.location.protocol == 'file:')	{
	baseURL  = "";
	}
else	{
	baseURL = document.location.protocol+"//"+document.domain+"/";
	}
document.getElementsByTagName('base')[0].href = baseURL;
</script>



<!--
all css includes need to be after the js that changes the base url.
css files should be included before any .js file to ensure they are downloaded in parallel
-->
<link rel="stylesheet" type="text/css" href="app-quickstart.css" />
<link rel="stylesheet" type="text/css" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/themes/ui-lightness/jquery-ui.css" />


<!-- jquery and jquery ui are pivotal to the functionality of the app. load them early -->
<script data-apptimize="embed" type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script data-apptimize="embed" type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js"></script>
<script data-apptimize="embed" type="text/javascript" src="controller.js"></script>
<script data-apptimize="embed" type="text/javascript" src="model.js"></script>

<!-- SCRIPTS -->
<script data-apptimize="embed" type="text/javascript" src="resources/jquery.showloading-v1.0.jt.js"></script>
<script data-apptimize="embed" type="text/javascript" src="resources/jsonpath.0.8.0.js"></script>
<script data-apptimize="embed" type="text/javascript" src="resources/tlc.js"></script>
<script data-apptimize="embed" type="text/javascript" src="resources/peg-0.8.0.js"></script>

<script data-apptimize="embed" type="text/javascript" src="resources/jquery.ui.anyplugins.js"></script>
<script data-apptimize="embed" type="text/javascript" src="includes.js"></script><!-- contains some polyfills and should be loaded early -->

<link data-apptimize="embed" rel="stylesheet" type="text/css" href="resources/anyplugins.css"/>
<link data-apptimize="embed" rel="stylesheet" type="text/css" href="extensions/checkout/styles.css"/>
<link data-apptimize="embed" rel="stylesheet" type="text/css" href="extensions/cart_message/styles.css"/>

<script type="text/javascript">
$.PromisePipeline = function(){
	var def = new $.Deferred();
	var deferreds = [];
	def.addDeferred = function(d){
		deferreds.push(d);
		}
	def.execute = function(){
		$.when.apply($,deferreds).done(function(){def.resolve();}).fail(function(){def.reject();});
		}
	return def;
}
</script>

<script type="text/javascript">
$(document).ready(function(){
	var paramStr = window.location.href.replace(window.location.hash, '').split('?')[1];
	if(!paramStr || paramStr.indexOf('_escaped_fragment_') < 0){
		window.myApp = new initApp({
			"release":"201405.a",  //increment this with each change. should solve caching issues. format: YYYYMMDDHHMMSS
			"_clientid":"zmvc", //zmvc for store app, 1pc for one page checkout.
			"baseURL":baseURL, //used in non-local mode.
			"checkoutAuthMode" : "active",//can be passive, active or required
			"testURL":"http://www.sportsworldchicago.com/", //used ONLY if protocol is file: (for testing)
			"addjQueryPointer" : true,
			"analyticsPointer" : "ga"
			});
		myCreole = new Parse.Simple.Creole();
		myApp.u.loadScript('app-quickstart-init.js?_v='+new Date().getTime());
		$('#appversion').text(myApp.vars.release);		
		}
	});

</script>


</head>

<body>
<!-- DELETE THIS WHEN YOU GET STARTED -->
<h1>WELCOME TO QUICKSTART</h1>
This file is intended to go along with the 10-step tutorial at:
<a href="https://github.com/zoovy/AnyCommerce-Development/wiki/quickstart">https://github.com/zoovy/AnyCommerce-Development/wiki/quickstart</a>
<!-- /DELETE THIS WHEN YOU GET STARTED -->





<div id='appView'>

<!--
ANIMATION TESTING
<div style="background: black; float: left;">
	<div data-animation-mouseenter="cogs?animFunc=fwd" data-animation-mouseout="cogs?animFunc=back" style="width: 55px; height: 55px;" id="cogs"></div>
</div>
-->


<!-- VIEW CONTENT -->
<!-- leave the appView div, put your your html here ...  -->

	<!--
	** REMINDER : DO NOT PUT ANY GRAPHICS/CONTENT THAT SHOULD NOT APPEAR ON EVERY PAGE IN THE VIEW (HERE)
	**				  INSTEAD PUT THEM INTO <div id='homepageTemplate'></div>
	-->
	
<div id='globalMessaging' class='appMessaging'></div><!-- DO NOT REMOVE - used for some high level error handling (usually appears below breadcrumb nav or top bar) -->


<!-- DO NOT REMOVE - this is where the specific page (ex: homepage, product, category) content is going to go -->
<div id='mainContentArea'>
	<div class="alignCenter"><img src="loading.gif"/></div>
</div>

<!-- ... your html ends -->
<!-- /VIEW CONTENT -->
</div>







<!--
*************************************************************************************************************
**
**
**										C A R T   M E S S A G E   U I      S T A R T S      H E R E
**
** A mechanism where buyers and merchants can communicate in real time.
**
*************************************************************************************************************
-->



<div id='cartMessenger' class='displayNone seoStrip' data-app-role='cartMessenger' title="help">
	<form novalidate='novalidate' onSubmit="return false">
		<div class='messageHistoryContainer'>
			<section data-app-role='messageHistory'></section>
		</div>
		<fieldset data-app-role='messageInput' class='smallButton messageInputContainer displayNone'>
			<textarea name='message' required='required' class='fullWidth' rows='5' placeholder='send a message'></textarea>
			<button class='applyButton' data-app-click='cart_message|chatPostExec' data-app-role='messageSubmitButton'>Send Message</button>
		</fieldset>
		<input type='text' placeholder='first name' name='bill/firstname' value='' data-tlc="bind $var 'bill.firstname'; apply --select=$var;" data-app-blur='cco|cartSetAttrib' />
		<section data-app-role='messageCommands' class='messageCommandsContainer'>
		<button class='applyButton displayNone show4ActiveChat' data-app-click="quickstart|cartMessagePageSend" title='Show the associate what page I am on.'>Send Page</button>
		<button data-app-click="cart_message|cartCSRShortcutExec" class='applyButton hide4ActiveChat'>Cart Shortcut</button><!-- if the buyer is already on the phone w/ the merchant, they could use this so the admin can access the cart -->
		</section>
	</form>
</div>

<div id='loginFormForModal' class='loginOption displayNone seoStrip' title='Please log in'>

<!-- the contents of this div/id are toggled on/off when login/logout occurs. don't change the ID -->


	<p id='loginMessaging' class='marginBottom appMessaging'></p>

	<div id='loginFormContainer'>
		<form action='#' data-app-submit='quickstart|accountLoginSubmit' class='marginBottom alignedForm'>
		<input type='hidden' name='method' value='unsecure' />
		<input type='hidden' name='loginCallback' id='loginCallback' value='' /><!-- used to save a callback action in -->
			<fieldset>
			<legend>Account Login</legend>
			<label>
				<span class='prompt'>Login/Email</span>
				<input type='email' class='alignInput' required='required'  name='login' value='' size='25'  />
			</label>
			<label>
				<span class='prompt'>Password</span>
				<input type='password' class='alignInput' required='required'  name='password' value='' size='25'  />	
			</label>
			<div class='alignRight'>
			<input type='submit' value='log in' class='applyButton ' />
			</div>
			</fieldset>
		</form>

		<div id='recoverPasswordContainer' class='marginBottom'>
			<div id='recoverPasswordMessaging' class='appMessaging'></div>
			<form action='#' data-app-submit='quickstart|accountPasswordRecoverSubmit' class='alignedForm'>
			<fieldset>
			<legend>Recover Password</legend>
			<label>
				<span class='prompt'>Login/Email</span>
				<input type='text' name='login' required='required' size='25' class='alignInput' />
			</label>
			<div class='alignRight'><input type='submit' class='applyButton' value='Email Password to Me' /></div>
			</fieldset>
			</form>
		</div><!-- /recoverPasswordContainer -->

		<div>
		<!-- !!!!! NOT YET IMPLEMENTED -->
		<a class='applyButton' href='#!customer/newsletter'>Create Account</a>
		</div>
	</div>

<!-- this div will appear after a successful login. if you bind a new action to the button, best to empty the div and re-add the button, so the actions don't statck. -->
	<div id='loginSuccessContainer' class='center displayNone'>
		<button class='applyButton' id='modalLoginContinueButton' data-app-click="quickstart|dialogCloseExec">Continue</button>
	</div>

</div>



<div class='debug displayNone seoStrip'>
<table>
<tr>
	<td>
<ul class='debugQuickLinks'>
	<li>Store Links
	<ul>
		<li><a href='/'>Homepage</a></li>
		<li><a href='/my_order_history/'>Orders</a></li>
		<li><a href='/cart/' >Cart</a></li>
		<li><a href='/return_policy/'>Returns</a></li>
		<li><a href='/privacy_policy/'>Privacy</a></li>
		<li><a href='#' onClick="return quickView('category',{'navcat':'.air_fresheners','templateID':'categoryTemplate'});">Cat in Modal</a></li>
	</ul>
	</li>
	<li><a href='#' onClick="myApp.ext.quickstart.a.showBuyerCMUI();">Messaging UI</a>
	<li>Some JS test links
	<ul>
		<li><a href='#' onClick="localStorage.clear();">Clear Local Storage</a></li>
	</ul>
	</li>
</ul>
	</td>
	<td>
<form name='headerSearchFrm' action='#' class='productSearchForm marginLeft' method="get" data-app-submit='quickstart|searchFormSubmit'>
	<input type='search' name='KEYWORDS' placeholder='product search' class="productSearchKeyword handleDefault" />
	<button>Search</button>
</form>
	</td>
</tr>
</table>

</div>

<script type="text/pegjs" id="pegjs">
dataTLC
 = grammar+

grammar
 = _ cmd:(IfStatement) _ lb* { return cmd; }
 / _ cmd:(WhileLoopStatement) _ lb* { return cmd; }
 / _ cmd:(ForeachLoopStatement) _ lb* { return cmd; }
 / _ cmd:(BindStatement) _ lb* { return cmd; } 
 / _ cmd:(SetStatement) _ lb* { return cmd; } 
 / _ cmd:(ExportStatement) _ lb* { return cmd; } 
 / _ cmd:(command) _ lb* { return cmd; }

command
 = _ module:([a-z_]+ "#")? cmd:[a-z?]+ args:((ws+ value)+)? _ lb* {
     return {
       type: "command",
       module: module ? module[0].join("") : "core",
       name: cmd.join("").toLowerCase(),
       args: args ? args.map(function(a) { return a[1] }) : null
     }
   }


// ** BIND **
// bind $var 'something'; (jsonpath lookup)
// bind $var $someothervar; (jsonpath lookup)
// bind $var ~tag; (returns tag id/path)
// bind ~tag '#tagid'; jQuery('#tagid')
// bind ~tag $tagid jQuery($tagid)
BindStatement
 = "bind" _ set:(variable / tag) _ src:(variable / scalar / tag) _ lb+ {
  return { type:"BIND", Set:set, Src:src }
  }


// ** EXPORT **
// export 'key' --dataset=$var
// export '%key' --dataset=$var
ExportStatement
= "export" _ set:(scalar / variable) args:(ws+ value)+ _ lb+ {
  return { type:"EXPORT", Set:set, args: args ? args.map(function(a) { return a[1] }) : null } 
  }

// ** SET ** 
// set $dst $src --path='.xyz';
SetStatement
 = "set" _ set:(variable / tag) _ src:(variable / scalar / tag / boolean / integer) args:((ws+ value)+)? _ lb+ {
  return { type:"SET", Set:set, Src:src, args: args ? args.map(function(a) { return a[1] }) : null }
  }

// if (command) {{ }} else {{ }};
IfStatement
  = "if" _ "(" _ condition:command _ ")" _ ifStatement:Block elseStatement:(_ "else" _ Block)? _ lb+ {
      return ({
        type: "IF",
        When: condition,
        IsTrue: ifStatement,
        IsFalse: elseStatement !== null ? elseStatement[3] : null
      });
   }

// while (something) {{ inner loop }};
WhileLoopStatement
  = "while" _ "(" _ condition:command _ ")" _ whileStatement:Block lb+ {
      return ({
        type: "WHILE",
        While: condition,
        Loop: whileStatement,
      });
   }


// foreach $item in $items {{ inner loop }};
ForeachLoopStatement
  = "foreach" _ set:(variable) _ "in" _ members:(variable) _ loop:Block lb+ {
      return ({
        type: "FOREACH",
        Set: set,
        Members: members,
        Loop: loop,
      });
   }


Block
  = "{{" _ statements:(StatementList _)? "}}" {
      return {
        type: "Block",
        statements: statements !== null ? statements[0][0] : []
      };
    }

StatementList
  = head:Statement tail:(_ Statement)* {
      var result = [head];
      for (var i = 0; i < tail.length; i++) {
        result.push(tail[i][1]);
      }
      return result;
    }

Statement
  = Block
  / grammar+


/* value types */

// ~tag is a reference to a jquery object
tag
 = "~" tag:([a-zA-Z]+) {
   // tag table should maintain reference to tags on DOM
   return { type:"tag", tag:tag.join(""), jq:null }
   }

boolean
 = "true" {return{ "type":"boolean", "value": true }}
 / "false" {return{ "type":"boolean", "value": false }}

// longopt start with a --
longopt
 = "--" k:([a-zA-Z]+) "=" v:( value ) {
    return {
       type: "longopt",
       key: k.join(""),
       value: v
       }
    }
 / "--" k:([a-zA-Z]+) {
    return {
      type: "longopt",
      key: k.join(""),
      value: null
      }
    }


// scalar (string)
// NOTE: at this point there is no way to escape a ' in a string.
//
scalar
 = "'" v:([^']*) "'" {
     return {
       type: "scalar",
       value: v.join("")
     }
   }

// Variables can't start with a number
variable
 = "$" v:([a-zA-Z0-9_]*) {
     return {
       type: "variable",
       value: v.join("")
     }
   }

integer
  = digits:[0-9]+ {
      return {
        type: "integer",
        value: parseInt(digits.join(""), 10)
      }
    }

hexcolor
  = "#" v:([A-Fa-f0-9][A-Fa-f0-9][A-Fa-f0-9][A-Fa-f0-9][A-Fa-f0-9][A-Fa-f0-9]) {
     return { type:"hexcolor", value: v.join("") }
     }

additive
  = left:muldiv _ sign:[+-] _ right:additive {
      return {
        type: "command",
        name:sign,
        args:[left,right]
      }
    }
  / muldiv

muldiv
  = left:primary _ sign:[*/] _ right:muldiv {
      return {
        type: "command",
        name: sign,
        args:[left, right]
      }
    }
  / primary

primary
  = (variable / integer)
  / "(" _ additive:additive _ ")" { return additive; }

value
 = longopt / variable / integer / scalar / boolean / tag / hexcolor / additive

// /* i am a comment (i can only appear before a command) */
comment
  = "/*" (!"*/" SourceCharacter)* "*/" { return{}; }

SourceCharacter
  = .

ws
 = [ \t\n\r]

_
 = (ws / comment)*

lb
 = ";"


</script>

</body>
</html>
